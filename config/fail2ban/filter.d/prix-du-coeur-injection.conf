# ============================================
# FILTRE: Tentatives d'injection
# ============================================
# Détecte les attaques:
# - SQL Injection
# - XSS (Cross-Site Scripting)
# - Path Traversal
# - Command Injection
# - LDAP Injection

[Definition]

# SQL Injection patterns
# Détecte: UNION SELECT, OR 1=1, DROP TABLE, etc.
# Note: %% = % échappé pour fail2ban
# IMPORTANT: On cible uniquement les requêtes API, pas les assets statiques
failregex = ^<HOST> .* "(GET|POST) /api/.*(%%27|\'|%%22|"|%%3B|;|%%2D%%2D|--|%%23|#|union\s+select|select\s+.*\s+from|insert\s+into|update\s+.*\s+set|delete\s+from|drop\s+(table|database)|truncate\s|exec\s*\(|execute\s|xp_|sp_cmdshell|0x[0-9a-fA-F]{8,})[^"]*" .*$
            ^<HOST> .* "(GET|POST) /api/.*(%%3C|<|%%3E|>|<script|javascript:|onerror\s*=|onload\s*=|onclick\s*=)[^"]*" .*$
            ^<HOST> .* "(GET|POST) .*(\.\.\/\.\.\/|\.\.\\\.\.\\|%%2e%%2e%%2f%%2e%%2e%%2f)[^"]*" .*$
            ^<HOST> .* "(GET|POST) .*(etc/passwd|etc/shadow|proc/self/environ|\.ssh/id_rsa)[^"]*" .*$
            ^<HOST> .* "(GET|POST) .*(SLEEP\(\d|BENCHMARK\(\d|WAITFOR\s+DELAY|PG_SLEEP\(\d)[^"]*" .*$

# Ignorer les requêtes sur les fichiers statiques (assets, images, etc.)
ignoreregex = ^<HOST> .* "(GET|HEAD) /assets/.*" .*$
              ^<HOST> .* "(GET|HEAD) .*\.(css|js|png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf|eot).*" .*$

# ⚠️ ATTENTION: Ce filtre cible maintenant uniquement /api/ pour les injections SQL
# Les assets statiques sont explicitement ignorés
